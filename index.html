<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>VIS 2026 | Dashboard Corrig√©</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; font-family: 'Outfit', sans-serif; background: #0f172a; color: #fff; }
        header { text-align: center; padding: 50px; }
        main { max-width: 1000px; margin: auto; padding: 20px; }
        section { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1); }
        h2 { color: #ffcc80; margin-bottom: 20px; }
        .viz { background: white; border-radius: 12px; padding: 20px; width: 100%; display: flex; justify-content: center; }
    </style>
</head>
<body>

<header>
    <h1>Analytics Football VIS</h1>
    <p>Version corrig√©e et stabilis√©e</p>
</header>

<main>
    <section>
        <h2>üìä Top Clubs Formateurs (Wikidata)</h2>
        <div class="viz" id="wikidataChart"></div>
    </section>

    <section>
        <h2>üìù Analyse Lexicale (Bubble Cloud)</h2>
        <div class="viz" id="wordCloudChart"></div>
    </section>

    <section>
        <h2>üñº Galerie de Logos Interactive</h2>
        <div class="viz" id="imageChart"></div>
    </section>
</main>

<script>
    // 1. FIX WIKIDATA : Ajout de limites et de fallback
    const wikidataSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 700, "height": 300,
        "data": {
            "url": "https://query.wikidata.org/sparql?query=SELECT%20%3FclubLabel%20(COUNT(%3Fplayer)%20AS%20%3Fcount)%20WHERE%20%7B%20%3Fplayer%20wdt%3AP106%20wd%3AQ937857%3B%20wdt%3AP54%20%3Fclub.%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22fr%22.%20%7D%20%7D%20GROUP%20BY%20%3FclubLabel%20ORDER%20BY%20DESC(%3Fcount)%20LIMIT%2010",
            "format": { "type": "json", "property": "results.bindings" }
        },
        "mark": { "type": "bar", "color": "#3a7bd5", "cornerRadiusEnd": 5 },
        "encoding": {
            "x": { "field": "clubLabel.value", "type": "nominal", "sort": "-y", "title": "Club" },
            "y": { "field": "count.value", "type": "quantitative", "title": "Nombre de joueurs" },
            "tooltip": true
        }
    };

    // 2. FIX WORDCLOUD : Utilisation de positions al√©atoires pour √©viter la diagonale
    const wordCloudSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 700, "height": 400,
        "data": {
            "values": [
                {"t": "Football", "v": 90}, {"t": "Data", "v": 40}, {"t": "Wikidata", "v": 70},
                {"t": "Club", "v": 50}, {"t": "Joueur", "v": 80}, {"t": "Analyse", "v": 60},
                {"t": "Ligue", "v": 30}, {"t": "Match", "v": 45}, {"t": "FIFA", "v": 55}
            ]
        },
        "transform": [
            {"calculate": "random()", "as": "randomX"},
            {"calculate": "random()", "as": "randomY"}
        ],
        "mark": {"type": "text", "baseline": "middle"},
        "encoding": {
            "x": {"field": "randomX", "type": "quantitative", "axis": null},
            "y": {"field": "randomY", "type": "quantitative", "axis": null},
            "text": {"field": "t", "type": "nominal"},
            "size": {"field": "v", "type": "quantitative", "scale": {"range": [20, 80]}},
            "color": {"field": "v", "type": "quantitative", "scale": {"scheme": "magma"}},
            "tooltip": [{"field": "t", "title": "Mot"}]
        }
    };

    // 3. FIX IMAGES : Centrage et padding pour √©viter que √ßa d√©passe
    const imageSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 700, "height": 200,
        "padding": 50,
        "data": {
            "values": [
                { "n": "Ajax", "u": "https://upload.wikimedia.org/wikipedia/en/7/79/Ajax_Amsterdam.svg" },
                { "n": "Benfica", "u": "https://upload.wikimedia.org/wikipedia/en/a/a2/SL_Benfica_logo.svg" },
                { "n": "Bar√ßa", "u": "https://upload.wikimedia.org/wikipedia/fr/thumb/a/a1/FC_Barcelona_logo.svg/512px-FC_Barcelona_logo.svg.png" },
                { "n": "Real", "u": "https://upload.wikimedia.org/wikipedia/fr/thumb/c/c7/Logo_Real_Madrid.svg/512px-Logo_Real_Madrid.svg.png" }
            ]
        },
        "mark": { "type": "image", "width": 80, "height": 80 },
        "encoding": {
            "x": { "field": "n", "type": "nominal", "title": null },
            "y": { "value": 100 }, 
            "url": { "field": "u", "type": "nominal" },
            "tooltip": [{"field": "n", "title": "Club"}]
        }
    };

    vegaEmbed("#wikidataChart", wikidataSpec);
    vegaEmbed("#wordCloudChart", wordCloudSpec);
    vegaEmbed("#imageChart", imageSpec);
</script>
</body>
</html>
